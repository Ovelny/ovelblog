<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>ovelny - information gathering</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="ovelny - Personal notes on learning infosec, penetration testing, programming and others"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" type=text/css href="/assets/css/dead-simple.min.css">
    <link rel="stylesheet" type=text/css href="/assets/css/rouge.min.css">
    <link
      href="/atom.xml"
      rel="alternate"
      title="ovelny"
      type="application/atom+xml"
    />
  </head>
  <body>

    <header>
      <section>
        <a href="/chasm/">
          <img
            class="logo"
            src="/assets/images/chasm.jpg"
            alt="chasm logo"
          />
        </a>
        <h2><a href="/chasm/">chasm</a></h2>
      </section>
      <nav>
        <a href="/">Home</a>
        <a href="/chasm/about/">About</a>
      </nav>
    </header>
    <main>

    <main>
        <h2>Information gathering</h2>
      <p>Information gathering is the first and one of the important steps in a penetraton test. The more information you gather, the bigger your attack surface, which leads to the best possible results. This is why it is often said that enumeration (which is listing technical elements) is key.</p>

<p>The whole practice of information gathering can be separated into two categories: passive information gathering, and active information gathering.</p>

<h2>Passive information gathering</h2>

<p>Passive information gathering is the act of gathering information on your target from publicly available sources, like social media accounts or search engines. You don&#39;t have to interact with the target by any means.</p>

<p>You should ideally gather the following information by passive means:</p>

<ul>
<li>IP addresses</li>
<li>Domains and subdomains</li>
<li>External partners and services</li>
<li>E-mail addresses</li>
<li>Naming conventions</li>
<li>Types of technology used</li>
</ul>

<h3>Semi-passive information gathering</h3>

<p>While passive information gathering does not touch any of the company&#39;s systems, semi-passive might. It involves ways to gather information such as visiting the company&#39;s website, which are on their own some sort of interaction with the target, but are completely indistinguishable from regular traffic.</p>

<p>Whether it is passive or semi-passive, let&#39;s review some techniques related to passive information gathering.</p>

<h3>DNS Enumeration</h3>

<p>DNS (<strong>D</strong>omain <strong>N</strong>ame <strong>S</strong>ystem) servers are a publicly available way of gathering info about your target. Those servers are the ones responsible from translating domain names (like google.com) to IP addresses.</p>

<p>You are always connecting to IP addresses when browsing the web, it is simply hidden from you with human-readable domain names as it is easier to remember.</p>

<p>As such, DNS records can give you useful information about your target. You can think of them as some sort of metadata regarding their registration online.</p>

<p>Records can be hard to decipher at first, but here are the ones you should focus on:</p>

<ul>
<li><strong>A (address)</strong> records contain the IP address of the related domain</li>
<li><strong>MX (Mail Exchange)</strong> records contain info about the mail exchange servers</li>
<li><strong>CNAME (Canonical Name)</strong> records contain info about related subdomains</li>
<li><strong>NS (Name Server)</strong> records contain info about the authoritative server of the related domain</li>
<li><strong>SOA (State of Authority)</strong> records contain various info about the domain, like the primary name server and a timestamp of the last time the domain has been updated</li>
<li><strong>PTR (Pointer Records)</strong> records contain info about the IPv4 address mapped to the <strong>CNAME</strong></li>
<li><strong>TXT</strong> records contain various text inserted freely by the administrator</li>
</ul>

<p>Various tools can be used on Linux to gather records from DNS servers: to name a few, <code>whois</code>, <code>nslookup</code>, <code>dig</code>, <code>host</code>, <code>Fierce</code>, <code>DNSenum</code>, <code>DNSrecon</code>.</p>

<h3>Whois</h3>

<p><code>whois</code> is one of the basic tools that can be used to gather DNS records. The usage is simple: <code>whois &lt;your-domain&gt;</code></p>

<p>Here is what <code>whois google.com</code> returns:</p>

<div class="highlight"><pre class="highlight shell"><code>Domain Name: GOOGLE.COM
Registry Domain ID: 2138514_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.markmonitor.com
Registrar URL: http://www.markmonitor.com
Updated Date: 2019-09-09T15:39:04Z
Creation Date: 1997-09-15T04:00:00Z
Registry Expiry Date: 2028-09-14T04:00:00Z
Registrar: MarkMonitor Inc.
Registrar IANA ID: 292
Registrar Abuse Contact Email: abusecomplaints@markmonitor.com
Registrar Abuse Contact Phone: +1.2083895740
Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
Domain Status: serverDeleteProhibited https://icann.org/epp#serverDeleteProhibited
Domain Status: serverTransferProhibited https://icann.org/epp#serverTransferProhibited
Domain Status: serverUpdateProhibited https://icann.org/epp#serverUpdateProhibited
Name Server: NS1.GOOGLE.COM
Name Server: NS2.GOOGLE.COM
Name Server: NS3.GOOGLE.COM
Name Server: NS4.GOOGLE.COM
DNSSEC: unsigned
URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
</code></pre></div>

<p>Here we can see info about the registrar, name servers and contact information.</p>

<h3>Nslookup</h3>

<p><code>nslookup</code> works just as simply as <code>whois</code>: <code>nslookup &lt;your-domain&gt;</code>. Here&#39;s the output for <code>nslookup google.com</code>:</p>

<div class="highlight"><pre class="highlight shell"><code>Server:         127.0.0.53
Address:        127.0.0.53#53

Non-authoritative answer:
Name:   google.com
Address: 172.217.20.110
Name:   google.com
Address: 2a00:1450:400e:80b::200e
</code></pre></div>

<p>We can see that it mainly outputs the IP address mapped to the domain. But you can also query DNS records with the <code>-type</code> flag, like this:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>nslookup <span class="nt">-type</span><span class="o">=</span>any google.com

Server:         127.0.0.53
Address:        127.0.0.53#53

Non-authoritative answer:
Name:   google.com
Address: 172.217.20.110
Name:   google.com
Address: 2a00:1450:400e:80b::200e
google.com      nameserver <span class="o">=</span> ns3.google.com.
Google.com      nameserver <span class="o">=</span> ns1.google.com.
Google.com      nameserver <span class="o">=</span> ns2.google.com.
Google.com      nameserver <span class="o">=</span> ns4.google.com.

Authoritative answers can be found from:
</code></pre></div>

<p>Here we can see that it returned the nameservers as well. Depending on the DNS configuration, the results can be more detailed and yield other records.</p>

<h3>Host</h3>

<p>The <code>host</code> command can also be used to fetch DNS records. Running <code>host</code> without any options and parameters will output the basic usage and related flags.</p>

<p>Running <code>host &lt;your-domain&gt;</code> will output the IP addresses related to the domain, as well as MX records.</p>

<p>Running <code>host &lt;your-IP&gt;</code> will perform a <strong>reverse lookup</strong>, and return the domain related to the IP.</p>

<h3>Zone transfers</h3>

<p>DNS servers play a critical role for many services and applications: they need to work, and they need to work all the time. As such, when a DNS server fails, another one is often configured to take over. That secondary server needs to hold the same data than the primary one, and so data is frequently synchronized.</p>

<p>We call that synchronization process a <strong>zone transfer</strong>. While it is usually fairly secured, sometimes DNS servers can be misconfigured and allow zone transfers to the public. This can yield a vast amount of useful records, like hidden subdomains, unsecured development servers, hostnames, etc.</p>

<p>Let&#39;s see how we can test for unsecure zone transfers. There is a vast amount of options available, but let&#39;s start with <code>host</code>.</p>

<p>We first need to retrieve name servers to check if they allow public zone transfers. This can be done with the following command :</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>host <span class="nt">-t</span> ns google.com

Google.com name server ns4.google.com.
Google.com name server ns2.google.com.
Google.com name server ns1.google.com.
Google.com name server ns3.google.com.
</code></pre></div>

<p>Now that we have their names, we can test a zone transfer with the following:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nv">$ </span>host <span class="nt">-t</span> axfr <span class="nt">-l</span> google.com ns4.google.com
</code></pre></div>

<p>As expected, you will notice that Google does not allow zone transfers.</p>

<h3>Wildcard domains</h3>

<p>A wildcard DNS record is usually noted as <code>*.mydomain.com</code>. If it is present, you will end up to the wildcard&#39;s IP address when you enter a subdomain that doesn&#39;t exist.</p>

<p>If <code>*.mydomain.com</code> resolves to 1.1.1.2 and you try to access <code>nothinghere.mydomain.com</code> which doesn&#39;t exist, the IP address returned will be 1.1.1.2.</p>

<h3>Dig</h3>

<p>Query a specific record type with <code>-t</code>, or any of them:</p>

<div class="highlight"><pre class="highlight shell"><code>dig <span class="nt">-t</span> any google.com
</code></pre></div>

<p>Test for zone transfers:</p>

<div class="highlight"><pre class="highlight shell"><code>dig axfr @nsztm1.digi.ninja zonetransfer.me
</code></pre></div>

<h3>Fierce</h3>

<p>Fierce is another reconnaissance tool written in Perl.</p>

<p>Run a DNS checkup on a target (zone transfer test + bruteforce subdomains):</p>

<div class="highlight"><pre class="highlight shell"><code>fierce <span class="nt">-dns</span> google.com
</code></pre></div>

<p>Run a checkup with an external wordlist for bruteforcing subdomains:</p>

<div class="highlight"><pre class="highlight shell"><code>fierce <span class="nt">-dns</span> google.com <span class="nt">--wordlist</span> &lt;wordlist-path&gt;
</code></pre></div>

<h3>DNSenum</h3>

<p>By default, this tool will try to gather everything it can from a domain name:</p>

<div class="highlight"><pre class="highlight shell"><code>dnsenum google.com
</code></pre></div>

<h3>DNSrecon</h3>

<p>Another automated, similar tool:</p>

<div class="highlight"><pre class="highlight shell"><code>dnsrecon <span class="nt">-d</span> google.com
</code></pre></div>

<h3>Sublist3r</h3>

<p>Sublist3r is focused on enumerating subdomains by using publicly available sources. It might not be readily available on your distro, so try to install it:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">sudo </span>apt <span class="nb">install </span>sublist3r
</code></pre></div>

<p>Run a default scan:</p>

<div class="highlight"><pre class="highlight shell"><code>sublist3r <span class="nt">-d</span> google.com
</code></pre></div>

<p>Add brute forcing using Subbrute, with 100 threads:</p>

<div class="highlight"><pre class="highlight shell"><code>sublist3r <span class="nt">-d</span> google.com <span class="nt">-b</span> <span class="nt">-t</span> 100
</code></pre></div>

<h3>Websites and Google Dorks</h3>

<p>You can gather information about your target simply by using some websites for this purpose, or Google Dorks, which are specialized Google searches using search operators in a clever way.</p>

<p>Here is a list of some websites that can help to gather intel:</p>

<ul>
<li><a href="https://www.exploit-db.com/google-hacking-database/" rel="nofollow">https://www.exploit-db.com/google-hacking-database/</a></li>
<li><a href="https://www.shodan.io/" rel="nofollow">https://www.shodan.io/</a></li>
<li><a href="https://www.tineye.com/" rel="nofollow">https://www.tineye.com/</a></li>
<li><a href="https://www.netcraft.com/" rel="nofollow">https://www.netcraft.com/</a></li>
<li><a href="https://pastebin.com/" rel="nofollow">https://pastebin.com/</a></li>
<li><a href="https://haveibeenpwned.com/" rel="nofollow">https://haveibeenpwned.com/</a></li>
</ul>

<h3>E-mail harvesting</h3>

<p>Collecting e-mail addresses from your target can be useful. Even a single one of them can leak the naming convention adopted by the company (<a href="mailto:john.doe@mail.com" rel="nofollow">john.doe@mail.com</a>, <a href="mailto:j.doe@mail.com" rel="nofollow">j.doe@mail.com</a>, etc).</p>

<h3>theharvester</h3>

<p>theharvester is a specialized tool for e-mail harvesting.</p>

<p>Search e-mail addresses from microsoft.com, using Google and returning only the first 8 results:</p>

<div class="highlight"><pre class="highlight shell"><code>theharvester <span class="nt">-d</span> microsoft.com <span class="nt">-b</span> google <span class="nt">-l</span> 8
</code></pre></div>

<h2>Active information gathering</h2>

<p>Active information gathering involves processes such as port scanning and fingerprinting services to enumerate your target&#39;s assets. In short, anything that requires to interact directly with your target can be defined as active information gathering.</p>

<h3>Host discovery</h3>

<p>Host discovery is the process of finding live hosts on a network. This is strictly contained in the scope of said network: for example your smartphone, laptop, computer etc behind your router are live hosts of your own network.</p>

<p>ARP and ICMP scans are often used for this part, one complementing the other to enumerate as many hosts as possible.</p>

<h3>arp-scan</h3>

<p>arp-scan is a tool to find live hosts on a network.</p>

<p>Find live hosts on your local network:</p>

<div class="highlight"><pre class="highlight shell"><code><span class="nb">sudo </span>arp-scan <span class="nt">--localnet</span>
</code></pre></div>

    </main>
    </main>
    <footer id="footer">
        <div class="footer-section">Copyright Â© 2019 - 2021 ovelny</div>
      <div class="footer-section">:(){ :|:& };:</div>
    </footer>
  </body>
</html>

